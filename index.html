<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Criminal Geoprofiler ‚Äî Mostro di Firenze</title>

  <!-- SEO base -->
  <meta name="description" content="Web-app didattica 100% client-side per la geoprofilazione: inserisci punti su mappa e genera heatmap con Rossmo/CGT, KDE, Centro di gravit√† e Journey-to-crime. Preset per il caso Mostro di Firenze." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="keywords" content="geoprofilazione, geoprofiling, Criminal Geographic Targeting, CGT, Rossmo, KDE, kernel density, heatmap, journey to crime, centro di gravit√†, mean center, criminologia, GIS, Leaflet, Mostro di Firenze, MdF, profilazione geografica" />
  <link rel="canonical" href="https://example.com/" />

  <!-- Preferenze tema -->
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Open Graph / Social (senza immagine) -->
  <meta property="og:title" content="Criminal Geoprofiler ‚Äî Mostro di Firenze" />
  <meta property="og:description" content="App client-side per esplorare metodi di geoprofilazione (Rossmo/CGT, KDE, Mean Center, Journey-to-crime) con heatmap interattive." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="it_IT" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Criminal Geoprofiler ‚Äî Mostro di Firenze" />
  <meta name="twitter:description" content="Web-app statica per geoprofilazione con Leaflet: punti su mappa, parametri regolabili, heatmap." />

  <!-- Structured Data JSON-LD -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Criminal Geoprofiler ‚Äî Mostro di Firenze",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Web",
      "inLanguage": "it-IT",
      "url": "https://example.com/",
      "description": "Web-app didattica per sperimentare metodi di geoprofilazione (Rossmo/CGT, KDE, Mean Center, Journey-to-crime) e visualizzare heatmap interattive.",
      "keywords": ["geoprofilazione","geoprofiling","Criminal Geographic Targeting","CGT","Rossmo","KDE","kernel density","heatmap","journey to crime","mean center","criminologia","GIS","Leaflet","Mostro di Firenze","MdF","profilazione geografica"]
    }
  </script>

  <!-- Performance: CDN/tiles -->
  <link rel="dns-prefetch" href="//unpkg.com" />
  <link rel="preconnect" href="https://unpkg.com" crossorigin />
  <link rel="dns-prefetch" href="//a.tile.openstreetmap.org" />
  <link rel="dns-prefetch" href="//b.tile.openstreetmap.org" />
  <link rel="dns-prefetch" href="//c.tile.openstreetmap.org" />
  <link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin />
  <link rel="preconnect" href="https://b.tile.openstreetmap.org" crossorigin />
  <link rel="preconnect" href="https://c.tile.openstreetmap.org" crossorigin />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="header">
      <div class="head-top">
        <h1 class="app-title">Criminal Geoprofiler ‚Äî Mostro di Firenze</h1>

      </div>
      <div class="head-actions">
          <button id="openTutorial" class="btn btn-ghost small" aria-haspopup="dialog" title="Apri il tutorial">‚ùì Tutorial</button>
          <button id="closeSidebar" class="btn btn-ghost small only-mobile" title="Chiudi pannello">‚úï</button>
          <button id="openAbout" class="btn btn-ghost small" aria-haspopup="dialog" title="Informazioni">‚ÑπÔ∏è About</button>
        </div>
      <p>Demo didattica 100% client-side: aggiungi punti sulla mappa e genera una mappa di probabilit√† con diversi metodi.</p>

        <!-- About modal -->
    <div id="aboutModal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="aboutTitle" aria-describedby="aboutBody" hidden>
        <div class="modal" role="document">
            <button class="modal-close" id="closeAbout" aria-label="Chiudi About">‚úï</button>
            <h2 id="aboutTitle">About ‚Äî Criminal Geoprofiler</h2>

            <p id="aboutBody" class="muted">
              Criminal Geoprofiler ‚Äî Mostro di Firenze √® un‚Äôapplicazione didattica, interamente client-side, pensata per esplorare in modo intuitivo come cambiano le superfici di verosimiglianza al variare dei dati e dei parametri nei principali metodi di geoprofilazione. Puoi caricare o inserire manualmente punti-evento sulla mappa, scegliere il metodo (Rossmo/CGT, KDE gaussiana, Centro di gravit√†, Journey-to-crime), regolare buffer/bandwidth/Œª e visualizzare il risultato come heatmap. Sono inclusi preset per il caso ‚ÄúMostro di Firenze‚Äù a scala provinciale e per due cluster territoriali.
            <br>
              Attenzione: i risultati sono indicativi e dipendono da posizionamento, scala, parametri e completezza del dataset. Non costituiscono prova n√© sostituiscono attivit√† investigative professionali. L‚Äôapp non effettua correlazioni temporali n√© inferenze autonome: elabora unicamente i punti forniti dall‚Äôutente o dai preset.
            <br>
              Contesto MdF: con ‚ÄúMostro di Firenze‚Äù si indica una serie di omicidi avvenuti tra il 1968 e il 1985 nell‚Äôarea fiorentina. I punti usati qui hanno finalit√† illustrative per mostrare differenze tra metodi e scale. 
            <br><br>
              <strong>L'autore dell‚Äôapplicazione ritiene, a titolo puramente personale, che la pista del ‚ÄúRosso del Mugello‚Äù sia la pi√π probabile e solida tra le ipotesi considerate; si tratta di un‚Äôopinione, non di un fatto accertato. </strong>
            <br><br>
              Privacy: l‚Äôelaborazione avviene localmente nel browser; l‚Äôunico traffico esterno riguarda le librerie CDN e le mappe OSM.
            <br>
              Codice sorgente su GitHub: https://github.com/Cepeppe/criminal-geoprofiler-mostrodifirenze
            </p>

            <div class="gh-link">
            <!-- Icona GitHub (inline SVG) -->
            <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false" width="20" height="20">
                <path fill="currentColor"
                d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38
                    0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
                    -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66
                    .07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15
                    -.08-.2-.36-1.01.08-2.1 0 0 .67-.21 2.2.82a7.63 7.63 0 0 1 2-.27c.68 0
                    1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.09.16 1.9.08 2.1.51.56.82
                    1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01
                    1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            <a href="https://https://github.com/Cepeppe/criminal-geoprofiler-mostrodifirenze" target="_blank" rel="noopener noreferrer">
                https://github.com/Cepeppe/criminal-geoprofiler-mostrodifirenze
            </a>
            </div>

            <div class="modal-actions">
            <button class="btn btn-primary" id="aboutOk">Chiudi</button>
            </div></div>
        </div>
    </div>

    <div class="panel">
      <h2>1) Punti evento</h2>
      <div class="row">
        <button id="btnToggleAdd" class="btn">‚ûï Modalit√† aggiunta: <span id="addModeState">ON</span></button>
        <button id="btnUndo" class="btn">‚Ü©Ô∏è Annulla</button>
        <button id="btnClear" class="btn btn-danger">üóëÔ∏è Svuota</button>
      </div>
      <p class="small muted">Clicca sulla mappa per aggiungere un punto. Clic su un marker per rimuoverlo.</p>
      <div class="kpi">
        <span class="badge">Punti: <span id="kpiCount">0</span></span>
        <span class="badge">Griglia: <span id="kpiGrid">‚Äì</span></span>
        <span class="badge">Tempo: <span id="kpiTime">‚Äì</span></span>
      </div>
      <ul id="pointsList" class="list"></ul>
    </div>

    <div class="panel">
      <h2>1.b) Aggiungi da coordinate</h2>
      <div class="row">
        <label for="coordInput" class="small">Lat, Lon (es: 43.794588, 11.082310)</label>
      </div>
      <div class="row">
        <input id="coordInput" type="text" placeholder="43.794588, 11.082310" />
        <button id="btnAddCoord" class="btn">‚ûï Aggiungi</button>
      </div>
      <p class="small muted">Formato accettato: <code>lat, lon</code> (punto decimale). Clic su un marker per rimuoverlo.</p>
    </div>

    <div class="panel"></div>

    <div class="panel">
      <h2>1.c) Dataset ‚Äî Mostro di Firenze</h2>
      <div class="desc small">
        <p>Carica i punti storici (1968‚Äì1985) direttamente come marker. Puoi poi aggiungere/rimuovere a mano, o filtrare per cluster geografico.</p>
      </div>
      <div class="row wrap">
        <button id="btnLoadAll" class="btn">Carica tutti (8)</button>
        <button id="btnLoadSW" class="btn">Carica cluster Sud-Ovest</button>
        <button id="btnLoadN" class="btn">Carica cluster Nord/NE</button>
        <button id="btnClearAll" class="btn btn-danger">Svuota punti</button>
      </div>
    </div>

    <div class="panel">
      <h2>2) Metodo</h2>
      <div class="row">
        <label for="method">Seleziona formula</label>
        <select id="method">
          <option value="rossmo">Rossmo / CGT</option>
          <option value="kde">KDE (Gaussiana)</option>
          <option value="meanCenter">Centro di gravit√†</option>
          <option value="journey">Journey-to-crime (esponenziale)</option>
        </select>
      </div>

      <div id="params-rossmo" class="params">
        <div class="row"><label>Buffer B (km)</label><input id="rossmoB" type="number" step="0.1" value="1.0"></div>
        <div class="row"><label>f (decadimento)</label><input id="rossmoF" type="number" step="0.1" value="1.2"></div>
        <div class="row"><label>g (compensazione)</label><input id="rossmoG" type="number" step="0.1" value="1.8"></div>
      </div>

      <div id="params-kde" class="params" style="display:none">
        <div class="row"><label>Bandwidth œÉ (km)</label><input id="kdeSigma" type="number" step="0.1" value="1.2"></div>
      </div>

      <div id="params-meanCenter" class="params" style="display:none">
        <div class="row"><label>Scala œÉ multipla</label><input id="mcScale" type="number" step="0.1" value="1.0"></div>
      </div>

      <div id="params-journey" class="params" style="display:none">
        <div class="row"><label>Lambda Œª (1/km)</label><input id="journeyLambda" type="number" step="0.05" value="0.7"></div>
      </div>

      <div class="row"><label>Passo griglia (m)</label><input id="gridStep" type="number" step="50" value="300"></div>
      <div class="row"><label>Raggio heatmap (px)</label><input id="heatRadius" type="number" step="1" value="18"></div>

      <div class="row">
        <button id="btnRun" class="btn btn-primary">üî• Calcola & mostra</button>
        <button id="btnClearOverlay" class="btn">üßπ Pulisci overlay</button>
      </div>

      <div class="legend">
        <span>Probabilit√†</span>
        <div class="legend-bar"></div>
      </div>

      <p class="attention"> <strong>ATTENZIONE: Se dopo aver premuto il pulsante "Calcola e Mostra" la zona di interesse non √® ben visibile, prova ad aumentare il parametro "Raggio heatmap (px)" a un valore maggiore di 50 e ricalcola</strong></p>
    </div>

    <div class="panel">
      <h2>3) Descrizione formula</h2>
      <div id="methodDesc" class="desc small"></div>
    </div>

    <div class="panel">
      <h2>4) Valori consigliati ‚Äî caso ‚ÄúMostro di Firenze‚Äù</h2>
      <div class="desc small">
        <p><b>Come determinarli (regole pratiche):</b></p>
        <ul>
          <li><b>Passo griglia</b>: ~ 1/30 della diagonale del bounding box o ~ 1/2‚Äì1/3 del <i>nearest neighbor</i>.</li>
          <li><b>Rossmo B</b>: 0.8‚Äì1.5 km nei cluster; 2‚Äì3 km su scala provinciale.</li>
          <li><b>Rossmo f/g</b>: f 1.2‚Äì1.5; g 1.6‚Äì1.9.</li>
          <li><b>KDE œÉ</b>: ‚âà 0.8 √ó mediana distanze k-NN (k=1..3) o 7‚Äì10% diagonale.</li>
          <li><b>Journey Œª</b>: scegli <i>d<sub>1/2</sub></i> e usa Œª = ln(2)/d<sub>1/2</sub>.</li>
        </ul>
      </div>

      <details class="acc" open>
        <summary><span class="caret"></span><span><b>A)</b> Scala provinciale (tutti gli 8 punti)</span></summary>
        <ul class="list kv">
          <li><span>Griglia / Heatmap</span><span>passo ‚âà <b>700 m</b> ¬∑ raggio ‚âà <b>24 px</b></span></li>
          <li><span>Rossmo/CGT</span><span>B=<b>2.5 km</b>; f=<b>1.2</b>; g=<b>1.6</b> <button id="applyProvRossmo" class="btn">Applica</button></span></li>
          <li><span>KDE</span><span>œÉ = <b>2.8 km</b> <button id="applyProvKDE" class="btn">Applica</button></span></li>
          <li><span>Centro di gravit√†</span><span>scala œÉ = <b>1.1√ó</b> <button id="applyProvMC" class="btn">Applica</button></span></li>
          <li><span>Journey-to-crime</span><span>Œª = <b>0.25 1/km</b> (d<sub>1/2</sub>‚âà2.77 km) <button id="applyProvJourney" class="btn">Applica</button></span></li>
        </ul>
      </details>

      <details class="acc">
        <summary><span class="caret"></span><span><b>B)</b> Cluster Sud-Ovest</span></summary>
        <ul class="list kv">
          <li><span>Griglia / Heatmap</span><span>passo ‚âà <b>325 m</b> ¬∑ raggio ‚âà <b>18 px</b></span></li>
          <li><span>Rossmo/CGT</span><span>B=<b>1.0 km</b>; f=<b>1.4</b>; g=<b>1.8</b> <button id="applySWRossmo" class="btn">Applica</button></span></li>
          <li><span>KDE</span><span>œÉ = <b>0.9 km</b> <button id="applySWKDE" class="btn">Applica</button></span></li>
          <li><span>Centro di gravit√†</span><span>scala œÉ = <b>0.9√ó</b> <button id="applySWMC" class="btn">Applica</button></span></li>
          <li><span>Journey-to-crime</span><span>Œª = <b>0.60 1/km</b> <button id="applySWJourney" class="btn">Applica</button></span></li>
        </ul>
      </details>

      <details class="acc">
        <summary><span class="caret"></span><span><b>C)</b> Cluster Nord / NE</span></summary>
        <ul class="list kv">
          <li><span>Griglia / Heatmap</span><span>passo ‚âà <b>400 m</b> ¬∑ raggio ‚âà <b>18 px</b></span></li>
          <li><span>Rossmo/CGT</span><span>B=<b>1.2 km</b>; f=<b>1.3</b>; g=<b>1.7</b> <button id="applyNRossmo" class="btn">Applica</button></span></li>
          <li><span>KDE</span><span>œÉ = <b>1.2 km</b> <button id="applyNKDE" class="btn">Applica</button></span></li>
          <li><span>Centro di gravit√†</span><span>scala œÉ = <b>1.0√ó</b> <button id="applyNMC" class="btn">Applica</button></span></li>
          <li><span>Journey-to-crime</span><span>Œª = <b>0.50 1/km</b> <button id="applyNJourney" class="btn">Applica</button></span></li>
        </ul>
      </details>
    </div>

    <div class="footer">
      <div class="pill">üó∫Ô∏è Tiles: OpenStreetMap ¬∑ Motore: Leaflet + Leaflet.heat</div>
      <div class="sep"></div>
      <p class="small">Questa √® una demo didattica. Le superfici mostrate sono <b>indicative</b> e dipendono dai parametri scelti.</p>
    </div>
  </aside>

  <div id="resizer" aria-label="Ridimensiona pannello" title="Trascina per ridimensionare"></div>
  <main id="map"></main>
</div>

<!-- Scrim per drawer mobile -->
<div id="sidebarScrim" class="scrim" hidden></div>
<!-- FAB per aprire la sidebar su mobile -->
<button id="toggleSidebar" class="fab only-mobile" title="Apri pannello">‚ò∞</button>

<!-- Tutorial modal -->
<div id="tutorialModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="tutorialTitle" aria-describedby="tutorialBody">
  <div class="modal" role="document">
    <button class="modal-close" id="closeTutorial" aria-label="Chiudi tutorial">‚úï</button>
    <h2 id="tutorialTitle">Criminal Geoprofiler ‚Äî Mostro di Firenze</h2>
    <p class="muted" id="tutorialBody">
      Questa applicazione √® una <b>demo didattica</b> di geoprofilazione <i>client-side</i>. Consente di:
    </p>
    <ul class="modal-list">
      <li>Caricare o inserire manualmente i <b>punti-evento</b> su mappa.</li>
      <li>Generare una superficie di <b>verosimiglianza</b> con pi√π metodi (Rossmo/CGT, KDE, Centro di gravit√†, Journey-to-crime).</li>
      <li>Regolare parametri e visualizzare una <b>heatmap</b>.</li>
    </ul>
    <div class="modal-steps">
      <h3>Come si usa (rapido):</h3>
      <ol>
        <li>Premi ‚ÄúCarica tutti‚Äù o clicca sulla mappa per aggiungere punti.</li>
        <li>Scegli il <b>metodo</b> e imposta i <b>parametri</b>.</li>
        <li>Premi <b>‚ÄúCalcola &amp; mostra‚Äù</b> per generare la heatmap.</li>
      </ol>
                <p class="attention"> <strong>ATTENZIONE: Se dopo aver premuto il pulsante "Calcola e Mostra" la zona di interesse non √® ben visibile, prova ad aumentare il parametro "Raggio heatmap (px)" a un valore maggiore di 50 e ricalcola</strong></p>
    </div>
    <p class="modal-warning">‚ö†Ô∏è Le mappe prodotte sono indicative e non sostituiscono attivit√† investigative professionali ‚ö†Ô∏è </p>
    <div class="modal-actions">
      <button class="btn btn-primary" id="startApp">Inizia</button>
    </div>
  </div>
</div>

<!-- Leaflet & plugins -->
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script defer src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<!-- App logic -->
<script defer src="app.js"></script>
</body>
</html>